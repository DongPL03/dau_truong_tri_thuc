<div class="notif-wrapper" (click)="$event.stopPropagation()">
  <button class="notif-btn" (click)="toggleDropdown()">
    <span class="icon">üîî</span>
    @if (unread_count > 0) {
      <span class="badge">{{ unread_count > 9 ? '9+' : unread_count }}</span>
    }
  </button>

  @if (show_dropdown) {
    <div class="notif-dropdown">
      <div class="notif-header">
        <span>Th√¥ng b√°o</span>
        <div class="notif-header-actions">
          <button class="link" (click)="markAllRead()" [disabled]="unread_count === 0">
            ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc h·∫øt
          </button>
          <a routerLink="/notifications" class="link">Xem t·∫•t c·∫£</a>
        </div>
      </div>


      @if (loading && notifications.length === 0) {
        <div class="notif-empty">ƒêang t·∫£i...</div>
      } @else {
        @if (notifications.length === 0) {
          <div class="notif-empty">Ch∆∞a c√≥ th√¥ng b√°o n√†o.</div>
        } @else {
          <ul class="notif-list">
            @for (n of notifications; track n.thong_bao_id) {
              <li class="notif-item"
                  [class.unread]="!n.da_doc"
                  (click)="onClickItem(n)">
                <div class="notif-title">
                  <strong>{{ n.nguoi_gui_ten }}</strong>
                  <span class="notif-type">‚Ä¢ {{ n.loai }}</span>
                </div>
                <div class="notif-body">
                  {{ n.noi_dung }}
                </div>
                <div class="notif-time">
                  {{ n.tao_luc | date:'dd/MM/yyyy HH:mm' }}
                </div>
              </li>
            }
          </ul>

          @if (has_more && !loading) {
            <button class="load-more" (click)="loadMore()">T·∫£i th√™m</button>
          }
          @if (loading && notifications.length > 0) {
            <div class="notif-loading-more">ƒêang t·∫£i th√™m...</div>
          }
        }
      }
    </div>
  }
</div>
@if (battle_invite_toast) {
  <div class="battle-invite-toast" (click)="$event.stopPropagation()">
    <div class="toast-title">
      üì£ L·ªùi m·ªùi tham gia ph√≤ng ƒë·∫•u
    </div>
    <div class="toast-body">
      <strong>{{ battle_invite_toast.nguoi_gui_ten }}</strong>
      <span> ƒë√£ m·ªùi b·∫°n v√†o ph√≤ng </span>
      @if (battle_invite_ma_phong) {
        <span class="room-code">#{{ battle_invite_ma_phong }}</span>
      }
    </div>
    <div class="toast-actions">
      <button class="btn-ghost" (click)="dismissBattleInvite()">ƒê·ªÉ sau</button>
      <button class="btn-primary" (click)="acceptBattleInvite()">Tham gia ngay</button>
    </div>
  </div>
}

