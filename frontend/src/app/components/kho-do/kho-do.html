<div class="kho-do-container">
    <div class="kho-do-header">
        <h1><i class="fas fa-box-open"></i> Kho ƒë·ªì c·ªßa b·∫°n</h1>
        @if (inventory()) {
        <div class="stats">
            <span class="stat-item">
                <i class="fas fa-cubes"></i>
                {{ inventory()!.tong_loai_vat_pham }} lo·∫°i
            </span>
            <span class="stat-item">
                <i class="fas fa-layer-group"></i>
                {{ inventory()!.tong_so_luong }} v·∫≠t ph·∫©m
            </span>
        </div>
        }
    </div>

    <!-- Filters -->
    <div class="filters">
        <button class="filter-btn"
            [class.active]="activeFilter() === 'all'"
            (click)="setFilter('all')">
            T·∫•t c·∫£
        </button>
        <button class="filter-btn"
            [class.active]="activeFilter() === 'usable'"
            (click)="setFilter('usable')">
            <i class="fas fa-bolt"></i> D√πng ƒë∆∞·ª£c
        </button>
        <button class="filter-btn rarity-common"
            [class.active]="activeFilter() === 'COMMON'"
            (click)="setFilter('COMMON')">
            Th∆∞·ªùng
        </button>
        <button class="filter-btn rarity-rare"
            [class.active]="activeFilter() === 'RARE'"
            (click)="setFilter('RARE')">
            Hi·∫øm
        </button>
        <button class="filter-btn rarity-epic"
            [class.active]="activeFilter() === 'EPIC'"
            (click)="setFilter('EPIC')">
            S·ª≠ thi
        </button>
        <button class="filter-btn rarity-legendary"
            [class.active]="activeFilter() === 'LEGENDARY'"
            (click)="setFilter('LEGENDARY')">
            Huy·ªÅn tho·∫°i
        </button>
    </div>

    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i kho ƒë·ªì...</p>
    </div>
    } @else if (filteredItems.length === 0) {
    <div class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Kho ƒë·ªì tr·ªëng</h3>
        <p>B·∫°n ch∆∞a c√≥ v·∫≠t ph·∫©m n√†o. H√£y ch∆°i game, ho√†n th√†nh nhi·ªám
            v·ª• ho·∫∑c mua t·ª´ Shop!</p>
    </div>
    } @else {
    <div class="items-grid">
        @for (item of filteredItems; track item.id) {
        <div class="item-card" [class]="getRarityClass(item.do_hiem)"
            (click)="selectItem(item)">
            <div class="item-icon">{{ item.icon }}</div>
            <div class="item-info">
                <h4 class="item-name">{{ item.ten }}</h4>
                <span class="item-quantity">x{{ item.so_luong
                    }}</span>
            </div>
            <div class="item-rarity">{{ getRarityLabel(item.do_hiem)
                }}</div>
            @if (item.co_the_su_dung) {
            <div class="usable-badge"
                title="C√≥ th·ªÉ s·ª≠ d·ª•ng trong tr·∫≠n">
                <i class="fas fa-bolt"></i>
            </div>
            }
        </div>
        }
    </div>
    }

    <!-- Item Detail Modal -->
    @if (selectedItem()) {
    <div class="detail-overlay" (click)="closeDetail()">
        <div class="detail-modal"
            [class]="getRarityClass(selectedItem()!.do_hiem)"
            (click)="$event.stopPropagation()">
            <button class="close-btn" (click)="closeDetail()">
                <i class="fas fa-times"></i>
            </button>

            <div class="detail-header">
                <div class="detail-icon">{{ selectedItem()!.icon }}
                </div>
                <div class="detail-title">
                    <h2>{{ selectedItem()!.ten }}</h2>
                    <span class="detail-rarity">{{
                        getRarityLabel(selectedItem()!.do_hiem)
                        }}</span>
                </div>
            </div>

            <div class="detail-content">
                <p class="detail-description">{{ selectedItem()!.mo_ta
                    }}</p>

                @if (selectedItem()!.hieu_ung) {
                <div class="detail-effect">
                    <i class="fas fa-magic"></i>
                    <span>{{ selectedItem()!.hieu_ung }}</span>
                </div>
                }

                <div class="detail-stats">
                    <div class="stat">
                        <span class="stat-label">S·ªë l∆∞·ª£ng</span>
                        <span class="stat-value">{{
                            selectedItem()!.so_luong }}</span>
                    </div>
                    @if (selectedItem()!.co_the_su_dung) {
                    <div class="stat usable">
                        <span class="stat-label">Tr·∫°ng th√°i</span>
                        <span class="stat-value"><i
                                class="fas fa-check-circle"></i> D√πng
                            ƒë∆∞·ª£c trong tr·∫≠n</span>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
    }
</div>