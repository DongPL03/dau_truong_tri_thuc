<div class="shop-page">

  <header class="shop-header animate-fade-down">
    <div class="header-content">
      <div class="title-group">
        <h1>üõçÔ∏è C·ª≠a H√†ng V·∫≠t Ph·∫©m</h1>
        <p>Mua s·∫Øm v·∫≠t ph·∫©m h·ªó tr·ª£ ƒë·ªÉ leo rank th·∫ßn t·ªëc!</p>
      </div>

      <div class="balance-card">
        <span class="label">S·ªë d∆∞ hi·ªán t·∫°i</span>
        <div class="coin-display">
          <span class="coin-icon">üí∞</span>
          <span class="amount">{{ tienVang() | number }} xu</span>
          <button class="btn-add-coin" title="N·∫°p th√™m">+</button>
        </div>
      </div>
    </div>
  </header>

  <div class="filter-bar animate-fade-up">
    <div class="filter-group">
      <label>ƒê·ªô hi·∫øm:</label>
      <select [ngModel]="filterRarity()" (ngModelChange)="filterRarity.set($event)">
        <option value="ALL">T·∫•t c·∫£</option>
        <option value="COMMON">Th∆∞·ªùng</option>
        <option value="RARE">Hi·∫øm</option>
        <option value="EPIC">S·ª≠ thi</option>
        <option value="LEGENDARY">Huy·ªÅn tho·∫°i</option>
      </select>
    </div>

    <div class="filter-group">
      <label>S·∫Øp x·∫øp:</label>
      <select [ngModel]="sortBy()" (ngModelChange)="sortBy.set($event)">
        <option value="PRICE_ASC">Gi√°: Th·∫•p -> Cao</option>
        <option value="PRICE_DESC">Gi√°: Cao -> Th·∫•p</option>
        <option value="RARITY">ƒê·ªô hi·∫øm</option>
      </select>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i c·ª≠a h√†ng...</p>
    </div>
  }

  @if (!loading()) {
    <div class="shop-grid animate-fade-up">
      @for (item of filteredItems(); track item.id) {
        <div class="item-card" [attr.data-rarity]="item.do_hiem" [class.disabled]="!item.co_the_mua">

          <div class="rarity-badge" [class]="getRarityClass(item.do_hiem)">
            {{ getRarityLabel(item.do_hiem) }}
          </div>

          <div class="item-icon-wrapper">
            <div class="icon-circle" [style.color]="item.mau_sac">
              {{ item.icon }} </div>
          </div>

          <div class="item-info">
            <h3 class="item-name">{{ item.ten }}</h3>
            <p class="item-desc">{{ item.mo_ta }}</p>
          </div>

          <div class="item-footer">
            <div class="price-tag">
              <span class="coin-symbol">üí∞</span> {{ item.gia_xu | number }}
            </div>

            @if (item.thong_bao_gioi_han) {
              <span class="limit-text warning">{{ item.thong_bao_gioi_han }}</span>
            } @else if (item.so_luong_con_lai_tuan < 99) {
              <span class="limit-text">C√≤n {{ item.so_luong_con_lai_tuan }}</span>
            }

            <button class="btn-buy" (click)="purchaseItem(item)"
                    [disabled]="!item.co_the_mua || purchasing() || tienVang() < item.gia_xu">
              @if (purchasing()) { <span class="spinner-sm"></span> }
              @else if (tienVang() < item.gia_xu) { Thi·∫øu xu }
              @else { Mua ngay }
            </button>
          </div>

        </div>
      }
    </div>

    @if (filteredItems().length === 0) {
      <div class="empty-state">
        <p>üîç Kh√¥ng t√¨m th·∫•y v·∫≠t ph·∫©m n√†o.</p>
      </div>
    }
  }

  <div class="shop-rules">
    <h3><i class="fas fa-info-circle"></i> Quy ƒë·ªãnh mua h√†ng</h3>
    <div class="rule-tags">
      <span class="tag legendary">üíé Legendary: 1/tu·∫ßn</span>
      <span class="tag epic">üíú Epic: 2/tu·∫ßn</span>
      <span class="tag common">üíö Common: Kh√¥ng gi·ªõi h·∫°n</span>
      <span class="tag reset">‚è∞ Reset: Th·ª© 2</span>
    </div>
  </div>

</div>
