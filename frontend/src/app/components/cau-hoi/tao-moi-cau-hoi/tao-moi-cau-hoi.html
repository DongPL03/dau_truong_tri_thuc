<div class="create-q-wrapper">

  <header class="q-header animate-fade-down">
    <div class="header-icon-orange">
      <i class="fas fa-plus"></i>
    </div>
    <div class="header-text">
      <h1>Th√™m C√¢u H·ªèi M·ªõi</h1>
      <p>L√†m phong ph√∫ b·ªô s∆∞u t·∫≠p tri th·ª©c c·ªßa b·∫°n</p>
    </div>
    <div class="header-actions">
      <button class="btn-back" (click)="cancel()">
        <i class="fas fa-arrow-left"></i> Quay l·∫°i
      </button>
    </div>
  </header>

  <div class="q-container">
    <form #form="ngForm" (ngSubmit)="onSubmit(form)" class="q-form" autocomplete="off">

      <div class="col-left animate-fade-right">

        <section class="form-card">
          <h3 class="card-title"><i class="fas fa-layer-group text-purple"></i> N·ªôi dung & ƒê·ªãnh d·∫°ng</h3>

          <div class="type-tabs">
            <div class="tab-item"
                 [class.active]="model.loai_noi_dung === 'VAN_BAN'"
                 (click)="model.loai_noi_dung = 'VAN_BAN'; onLoaiNoiDungChange()">
              <span class="icon">üìù</span> VƒÉn b·∫£n
            </div>
            <div class="tab-item"
                 [class.active]="model.loai_noi_dung === 'HINH_ANH'"
                 (click)="model.loai_noi_dung = 'HINH_ANH'; onLoaiNoiDungChange()">
              <span class="icon">üñºÔ∏è</span> H√¨nh ·∫£nh
            </div>
            <div class="tab-item"
                 [class.active]="model.loai_noi_dung === 'AM_THANH'"
                 (click)="model.loai_noi_dung = 'AM_THANH'; onLoaiNoiDungChange()">
              <span class="icon">üéµ</span> √Çm thanh
            </div>
          </div>

          <div class="input-group mt-4">
            <label>C√¢u h·ªèi <span class="req">*</span></label>
            <textarea [(ngModel)]="model.noi_dung" name="noi_dung" rows="4"
                      class="form-input"
                      placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi..." required></textarea>
          </div>

          @if (model.loai_noi_dung !== 'VAN_BAN') {
            <div class="media-upload-area" [class.has-file]="!!previewUrl">
              @if (!previewUrl) {
                <div class="upload-placeholder" (click)="fileInput.click()">
                  <div class="icon-cloud"><i class="fas fa-cloud-upload-alt"></i></div>
                  <p>Nh·∫•n ƒë·ªÉ t·∫£i l√™n <strong>{{ model.loai_noi_dung === 'HINH_ANH' ? 'H√¨nh ·∫£nh' : '√Çm thanh' }}</strong></p>
                  <span class="sub-text">H·ªó tr·ª£ JPG, PNG, MP3 (Max 10MB)</span>
                </div>
              } @else {
                <div class="preview-box">
                  @if (model.loai_noi_dung === 'HINH_ANH') {
                    <img [src]="previewUrl" class="preview-img"/>
                  } @else {
                    <div class="audio-player">
                      <audio controls [src]="previewUrl"></audio>
                    </div>
                  }
                  <button type="button" class="btn-remove-file" (click)="removeSelectedFile()">
                    <i class="fas fa-trash-alt"></i> X√≥a file
                  </button>
                </div>
              }
              <input #fileInput type="file" hidden accept="image/*,audio/*" (change)="onFileSelected($event)">
            </div>
          }
        </section>

        <section class="form-card mt-4">
          <h3 class="card-title"><i class="fas fa-sliders-h text-purple"></i> Thi·∫øt l·∫≠p b·ªï sung</h3>

          <div class="input-group">
            <label>ƒê·ªô kh√≥</label>
            <div class="select-wrapper">
              <select [(ngModel)]="model.do_kho" name="do_kho" class="form-select">
                <option value="DE">üü¢ D·ªÖ</option>
                <option value="TRUNG_BINH">üü° Trung B√¨nh</option>
                <option value="KHO">üî¥ Kh√≥</option>
              </select>
              <i class="fas fa-chevron-down arrow-icon"></i>
            </div>
          </div>

          <div class="input-group mt-3">
            <label>Gi·∫£i th√≠ch ƒë√°p √°n</label>
            <textarea [(ngModel)]="model.giai_thich" name="giai_thich" rows="2"
                      class="form-input"
                      placeholder="Hi·ªÉn th·ªã khi ng∆∞·ªùi ch∆°i tr·∫£ l·ªùi sai..."></textarea>
          </div>
        </section>
      </div>

      <div class="col-right animate-fade-left">
        <section class="form-card h-100">
          <h3 class="card-title">
            <i class="fas fa-check-circle text-green"></i> Thi·∫øt l·∫≠p ƒë√°p √°n
            <span class="badge-info">Ch·ªçn 1 ƒë√°p √°n ƒë√∫ng</span>
          </h3>

          <div class="answers-grid">
            @for (opt of luaChonList; track opt) {
              <div class="answer-card"
                   [class.is-correct]="model.dap_an_dung === opt"
                   (click)="model.dap_an_dung = opt">

                <input type="radio" hidden name="dap_an_dung" [value]="opt" [(ngModel)]="model.dap_an_dung">

                <div class="card-header">
                  <div class="letter-badge">{{ opt }}</div>
                  <div class="radio-circle">
                    <i class="fas fa-check"></i>
                  </div>
                </div>

                <div class="card-body">
                  <input type="text"
                         [(ngModel)]="model['lua_chon_' + opt.toLowerCase()]"
                         name="lua_chon_{{opt}}"
                         class="answer-input"
                         placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." required>
                </div>
              </div>
            }
          </div>
        </section>
      </div>

      <div class="form-footer animate-fade-up">
        <button type="submit" class="btn-primary-3d" [disabled]="submitting">
          @if (submitting) {
            <i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...
          } @else {
            <i class="fas fa-save"></i> L∆ØU C√ÇU H·ªéI
          }
        </button>
      </div>

    </form>
  </div>
</div>
