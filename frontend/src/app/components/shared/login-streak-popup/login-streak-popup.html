<div class="streak-overlay" (click)="closePopup()">
    <div class="streak-popup" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="popup-header">
            <h2>üî• ƒêi·ªÉm danh h√†ng ng√†y</h2>
            <button class="close-btn" (click)="closePopup()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        @if (loading()) {
        <div class="loading-state">
            <div class="spinner"></div>
            <p>ƒêang t·∫£i...</p>
        </div>
        } @else if (streakInfo()) {
        <div class="popup-content">
            <!-- Streak Counter -->
            <div class="streak-counter">
                <div class="streak-number">{{
                    streakInfo()!.streak_hien_tai }}</div>
                <div class="streak-label">ng√†y li√™n t·ª•c</div>
            </div>

            <!-- Days Grid -->
            <div class="days-grid">
                @for (day of streakInfo()!.danh_sach_ngay; track
                day.ngay) {
                <div class="day-card" [class]="getDayClass(day)">
                    <div class="day-header">
                        <span class="day-number">Ng√†y {{ day.ngay
                            }}</span>
                        @if (day.da_nhan) {
                        <i class="fas fa-check-circle check-icon"></i>
                        }
                    </div>

                    <div class="day-rewards">
                        <div class="reward-item gold">
                            <span class="reward-icon">üí∞</span>
                            <span class="reward-value">{{ day.gold
                                }}</span>
                        </div>
                        @if (day.xp > 0) {
                        <div class="reward-item xp">
                            <span class="reward-icon">‚≠ê</span>
                            <span class="reward-value">{{ day.xp
                                }}</span>
                        </div>
                        }
                        @if (day.co_vat_pham) {
                        <div class="reward-item item">
                            <span class="reward-icon">üéÅ</span>
                        </div>
                        }
                    </div>

                    @if (day.la_hom_nay &&
                    !streakInfo()!.da_diem_danh_hom_nay) {
                    <div class="today-badge">H√îM NAY</div>
                    }
                </div>
                }
            </div>

            <!-- Claim Button -->
            <div class="claim-section">
                @if (streakInfo()!.da_diem_danh_hom_nay) {
                <button class="claim-btn claimed" disabled>
                    <i class="fas fa-check"></i> ƒê√£ ƒëi·ªÉm danh
                </button>
                <p class="next-claim-hint">Quay l·∫°i v√†o ng√†y mai ƒë·ªÉ
                    ti·∫øp t·ª•c! üåü</p>
                } @else {
                <button class="claim-btn" (click)="claimReward()"
                    [disabled]="claiming()">
                    @if (claiming()) {
                    <div class="btn-spinner"></div>
                    } @else {
                    <i class="fas fa-gift"></i> Nh·∫≠n th∆∞·ªüng ng√†y {{
                    streakInfo()!.ngay_trong_chu_ky }}
                    }
                </button>
                @if (streakInfo()!.phan_thuong_hom_nay) {
                <div class="today-reward-preview">
                    <span>üí∞ {{
                        streakInfo()!.phan_thuong_hom_nay!.gold }}
                        Gold</span>
                    @if (streakInfo()!.phan_thuong_hom_nay!.xp > 0) {
                    <span>‚≠ê {{ streakInfo()!.phan_thuong_hom_nay!.xp
                        }} XP</span>
                    }
                    @if
                    (streakInfo()!.phan_thuong_hom_nay!.vat_pham_ten)
                    {
                    <span>üéÅ {{
                        streakInfo()!.phan_thuong_hom_nay!.so_luong_vat_pham
                        }}x {{
                        streakInfo()!.phan_thuong_hom_nay!.vat_pham_ten
                        }}</span>
                    }
                </div>
                }
                }
            </div>
        </div>
        }
    </div>
</div>