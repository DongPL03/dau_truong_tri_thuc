@if (!loading) {
  <div class="edit-container">

    <header class="edit-header">
      <div class="header-icon-3d">
        <i class="fas fa-edit"></i>
      </div>
      <div class="header-content">
        <h1>Hiệu Chỉnh Nội Dung</h1>
        <p>Cập nhật thông tin và cài đặt cho bộ câu hỏi của bạn.</p>

        <div class="status-badge-wrapper">
          @if (currentStatus === 'DA_DUYET') {
            <span class="badge approved"><i class="fas fa-check-circle"></i> Đã duyệt</span>
          } @else if (currentStatus === 'CHO_DUYET') {
            <span class="badge pending"><i class="fas fa-clock"></i> Chờ duyệt</span>
          } @else if (currentStatus === 'TU_CHOI') {
            <span class="badge rejected"><i class="fas fa-ban"></i> Từ chối</span>
          }
        </div>
      </div>
    </header>

    <div class="edit-card">
      <form #editForm="ngForm" (ngSubmit)="onSubmit(editForm)" class="edit-form" autocomplete="off">

        <div class="form-layout">

          <section class="form-section left-col">
            <h3 class="section-title"><i class="fas fa-info-circle"></i> Thông Tin Chung</h3>

            <div class="form-group">
              <label>Tiêu đề bộ câu hỏi <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fas fa-heading input-icon"></i>
                <input type="text"
                       name="tieu_de"
                       [(ngModel)]="dto.tieu_de"
                       maxlength="100"
                       placeholder="Nhập tiêu đề mới..."
                       required>
              </div>
            </div>

            <div class="form-group">
              <label>Chủ đề kiến thức <span class="required">*</span></label>
              <div class="select-wrapper">
                <i class="fas fa-layer-group input-icon"></i>
                <select name="chu_de_id" required [(ngModel)]="dto.chu_de_id">
                  @for (c of chuDes; track c.id) {
                    <option [value]="c.id">{{ c.ten }}</option>
                  }
                </select>
                <i class="fas fa-chevron-down arrow-icon"></i>
              </div>
            </div>

            <div class="form-group">
              <label>Mô tả ngắn</label>
              <div class="textarea-wrapper">
                <i class="fas fa-align-left input-icon textarea-icon"></i>
                <textarea name="mo_ta"
                          rows="5"
                          maxlength="255"
                          [(ngModel)]="dto.mo_ta"
                          placeholder="Mô tả nội dung bộ câu hỏi..."></textarea>
              </div>
            </div>
          </section>

          <section class="form-section right-col">
            <h3 class="section-title"><i class="fas fa-cog"></i> Cấu Hình</h3>

            <div class="form-group">
              <label>Chế độ hiển thị</label>

              <div class="visibility-options">

                <label class="visual-card public-card" [class.selected]="dto.che_do_hien_thi === 'PUBLIC'">
                  <input type="radio" name="che_do_hien_thi" value="PUBLIC" [(ngModel)]="dto.che_do_hien_thi" hidden>
                  <div class="card-icon"><i class="fas fa-globe-americas"></i></div>
                  <div class="card-info">
                    <span class="card-name">Công Khai</span>
                    <span class="card-desc">Hiển thị cho mọi người.</span>
                  </div>
                  <div class="check-circle"><i class="fas fa-check"></i></div>
                </label>

                <label class="visual-card private-card" [class.selected]="dto.che_do_hien_thi === 'PRIVATE'">
                  <input type="radio" name="che_do_hien_thi" value="PRIVATE" [(ngModel)]="dto.che_do_hien_thi" hidden>
                  <div class="card-icon"><i class="fas fa-lock"></i></div>
                  <div class="card-info">
                    <span class="card-name">Riêng Tư</span>
                    <span class="card-desc">Chỉ mình bạn thấy.</span>
                  </div>
                  <div class="check-circle"><i class="fas fa-check"></i></div>
                </label>

              </div>
            </div>

            @if (dto.che_do_hien_thi === 'PUBLIC') {
              <div class="warning-box">
                <div class="warn-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <p><strong>Lưu ý:</strong> Chỉnh sửa nội dung có thể khiến bộ câu hỏi chuyển về trạng thái <strong>Chờ
                  duyệt</strong>.</p>
              </div>
            }

          </section>
        </div>

        <div class="form-footer">
          <button type="button" class="btn-ghost" (click)="cancel()">
            <i class="fas fa-arrow-left"></i> Hủy & Quay lại
          </button>
          <button type="submit" class="btn-save-3d" [disabled]="saving">
            @if (saving) {
              <i class="fas fa-spinner fa-spin"></i> Đang lưu...
            } @else {
              <span class="btn-content">
                <i class="fas fa-save"></i> LƯU THAY ĐỔI
              </span>
            }
          </button>
        </div>

      </form>
    </div>

  </div>
} @else {
  <div class="loading-screen">
    <div class="spinner"></div>
    <p>Đang tải dữ liệu...</p>
  </div>
}
