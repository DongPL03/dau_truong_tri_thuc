<div class="social-page">
  <div class="bg-decor-1"></div>
  <div class="bg-decor-2"></div>

  <div class="social-container">

    <header class="social-header animate-fade-down">
      <div class="header-left">
        <div class="icon-box">ü§ù</div>
        <div class="text-group">
          <h1>S·∫£nh K·∫øt N·ªëi</h1>
          <p>T√¨m ki·∫øm ƒë·ªìng ƒë·ªôi, m·ªü r·ªông v√≤ng tr√≤n tri th·ª©c</p>
        </div>
      </div>

      <div class="add-friend-bar">
        <div class="input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="number"
                 [(ngModel)]="new_friend_id"
                 placeholder="Nh·∫≠p ID ng∆∞·ªùi ch∆°i ƒë·ªÉ k·∫øt b·∫°n..."
                 (keyup.enter)="sendFriendRequest()">
        </div>
        <button class="btn-add" [disabled]="sending_request" (click)="sendFriendRequest()">
          @if (sending_request) {
            <i class="fas fa-spinner fa-spin"></i>
          } @else {
            <i class="fas fa-user-plus"></i> G·ª≠i l·ªùi m·ªùi
          }
        </button>
      </div>
    </header>

    <div class="nav-tabs animate-fade-up">
      <button class="tab-pill" [class.active]="active_tab === 'friends'" (click)="setTab('friends')">
        B·∫°n b√® <span class="count">{{ friends.length }}</span>
      </button>
      <button class="tab-pill" [class.active]="active_tab === 'incoming'" (click)="setTab('incoming')">
        L·ªùi m·ªùi ƒë·∫øn
        @if (incoming_requests.length > 0) {
          <span class="badge-red">{{ incoming_requests.length }}</span>
        }
      </button>
      <button class="tab-pill" [class.active]="active_tab === 'outgoing'" (click)="setTab('outgoing')">
        ƒê√£ g·ª≠i <span class="count">{{ outgoing_requests.length }}</span>
      </button>
    </div>

    <div class="content-area animate-scale-up">

      @if (loading_friends || loading_incoming || loading_outgoing) {
        <div class="loading-state">
          <div class="spinner-3d"></div>
          <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>
      } @else {

        @if (active_tab === 'friends') {
          @if (friends.length === 0) {
            <div class="empty-state">
              <img src="assets/images/empty-friends.png" onerror="this.style.display='none'">
              <p>Danh s√°ch b·∫°n b√® ƒëang tr·ªëng. H√£y k·∫øt th√™m b·∫°n m·ªõi nh√©!</p>
            </div>
          } @else {
            <div class="grid-layout">
              @for (f of friends; track f.user_id) {
                <div class="user-card friend-card">
                  <div class="status-dot" [class.online]="f.trang_thai === 'ONLINE'"></div>

                  <div class="card-avatar">
                    <img [src]="getAvatar(f.avatar_url, f.ho_ten)">
                  </div>

                  <div class="card-info">
                    <h3>{{ f.ho_ten }}</h3>
                    <div class="sub-info">
                      <span class="uid">ID: {{ f.user_id }}</span>
                      <span class="status-text" [class.on]="f.trang_thai === 'ONLINE'">
                        {{ f.trang_thai === 'ONLINE' ? 'Online' : 'Offline' }}
                      </span>
                    </div>
                  </div>

                  <div class="card-actions">
                    <button class="btn-icon chat" title="Nh·∫Øn tin" (click)="navigateChatWithFriend(f)">
                      <i class="fas fa-comment-dots"></i>
                    </button>
                    <button class="btn-icon remove" (click)="unfriend(f)" title="H·ªßy k·∫øt b·∫°n">
                      <i class="fas fa-user-minus"></i>
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        }

        @if (active_tab === 'incoming') {
          @if (incoming_requests.length === 0) {
            <div class="empty-state">
              <p>Kh√¥ng c√≥ l·ªùi m·ªùi k·∫øt b·∫°n n√†o.</p>
            </div>
          } @else {
            <div class="grid-layout">
              @for (req of incoming_requests; track req.request_id) {
                <div class="user-card request-card">
                  <div class="card-avatar">
                    <img [src]="getAvatar(null, req.nguoi_gui_ten)"></div>
                  <div class="card-info">
                    <h3>{{ req.nguoi_gui_ten }}</h3>
                    <span class="time-ago">G·ª≠i l√∫c: {{ req.tao_luc | date:'dd/MM HH:mm' }}</span>
                  </div>
                  <div class="action-row">
                    <button class="btn-pill accept" (click)="acceptRequest(req)">Ch·∫•p nh·∫≠n</button>
                    <button class="btn-pill decline" (click)="declineRequest(req)">X√≥a</button>
                  </div>
                </div>
              }
            </div>
          }
        }

        @if (active_tab === 'outgoing') {
          @if (outgoing_requests.length === 0) {
            <div class="empty-state">
              <p>B·∫°n ch∆∞a g·ª≠i l·ªùi m·ªùi n√†o.</p>
            </div>
          } @else {
            <div class="grid-layout">
              @for (req of outgoing_requests; track req.request_id) {
                <div class="user-card sent-card">
                  <div class="card-avatar grayscale">
                    <img [src]="getAvatar(null, req.nguoi_nhan_ten)">
                  </div>
                  <div class="card-info">
                    <h3>{{ req.nguoi_nhan_ten }}</h3>
                    <span class="time-ago">ƒê√£ g·ª≠i: {{ req.tao_luc | date:'dd/MM HH:mm' }}</span>
                    <span class="status-badge pending">ƒêang ch·ªù...</span>
                  </div>
                  <div class="card-actions">
                    <button class="btn-text cancel" (click)="cancelRequest(req)">
                      <i class="fas fa-times"></i> H·ªßy l·ªùi m·ªùi
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        }

      }
    </div>
  </div>
</div>
