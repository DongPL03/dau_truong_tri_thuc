<div class="game-dashboard">
  <header class="hero-header">
    <div class="greeting-content">
      <h1>Xin ch√†o, <span class="highlight-name">{{ user?.ho_ten }}</span>! üöÄ</h1>
      <p>H√¥m nay l√† m·ªôt ng√†y tuy·ªát v·ªùi ƒë·ªÉ leo rank!</p>
    </div>
    <div class="header-decoration">
    </div>
  </header>

  <div class="main-layout">
    <aside class="sidebar-panel">
      <section class="card profile-card">
        <div class="profile-header">
          <div class="avatar-container">
            <i class="fas fa-user-astronaut"></i>
          </div>
          <div class="level-badge">Lv. {{ user_summary?.level ?? 1 }}</div>
        </div>

        <div class="xp-container">
          <div class="xp-info">
            <span>XP</span>
            <span class="xp-val">{{ user_summary?.xp_in_current_level || 0 }} / {{ (user_summary?.xp_in_current_level || 0) + (user_summary?.xp_next_level || 100) }}</span>
          </div>
          <div class="progress-track">
            <div class="progress-fill" [style.width.%]="user_summary?.level_progress_percent || 0"></div>
          </div>
        </div>
      </section>

      <section class="stats-grid">
        <div class="stat-item rank-card">
          <div class="icon-box rank-icon"><i class="fas fa-trophy"></i></div>
          <div class="stat-text">
            <span class="label">H·∫°ng</span>
            <span class="value">#{{ user_summary?.xep_hang || '--' }}</span>
          </div>
        </div>

        <div class="stat-item win-card">
          <div class="icon-box win-icon"><i class="fas fa-fist-raised"></i></div>
          <div class="stat-text">
            <span class="label">Th·∫Øng</span>
            <span class="value">{{ user_summary?.ti_le_thang | percent:'1.0-0' }}</span>
          </div>
        </div>

        <div class="stat-item coin-card">
          <div class="icon-box coin-icon"><i class="fas fa-coins"></i></div>
          <div class="stat-text">
            <span class="label">V√†ng</span>
            <span class="value text-gold">{{ user_summary?.tien_vang ?? 0 }}</span>
          </div>
        </div>

        <div class="stat-item score-card">
          <div class="icon-box score-icon"><i class="fas fa-star"></i></div>
          <div class="stat-text">
            <span class="label">ƒêi·ªÉm</span>
            <span class="value">{{ user_summary?.tong_diem | number:'1.0-0' }}</span>
          </div>
        </div>
      </section>

      <button class="btn-3d btn-weekly" (click)="claimWeeklyReward()">
        <span class="icon">üéÅ</span> Nh·∫≠n qu√† tu·∫ßn
      </button>
    </aside>

    <main class="content-panel">

      <section class="action-center">
        <button class="btn-3d btn-battle-big" (click)="navigateBattle()">
          <div class="btn-content">
            <i class="fas fa-swords"></i>
            <span>T√åM TR·∫¨N ƒê·∫§U</span>
            <small>Ch·∫ø ƒë·ªô x·∫øp h·∫°ng</small>
          </div>
          <div class="shine-effect"></div>
        </button>

        <div class="sub-actions">
          <button class="btn-3d btn-secondary" (click)="navigatePractice()">
            <i class="fas fa-dumbbell"></i> Luy·ªán t·∫≠p
          </button>
          <button class="btn-3d btn-secondary" (click)="navigateQuiz()">
            <i class="fas fa-plus"></i> T·∫°o c√¢u h·ªèi
          </button>
          <button class="btn-3d btn-secondary" (click)="navigateFriend()">
            <i class="fas fa-user-friends"></i> B·∫°n b√®
          </button>
        </div>
      </section>

      <section class="card feed-card">
        <h2 class="card-title">üî• V·ª´a di·ªÖn ra</h2>
        <div class="feed-list">
          @if (recent_matches.length > 0) {
            @for (m of recent_matches; track m.lich_su_id) {
              <div class="feed-row" [class.is-winner]="m.xep_hang === 1">
                <div class="feed-status">
                  @if (m.xep_hang === 1) {
                    <span class="badge-win">VICTORY</span>
                  } @else {
                    <span class="badge-rank">TOP {{ m.xep_hang }}</span>
                  }
                </div>
                <div class="feed-detail">
                  <p class="quiz-name">{{ m.bo_cau_hoi_tieu_de }}</p>
                  <p class="quiz-score">+{{ m.tong_diem }} ƒëi·ªÉm ‚Ä¢ {{ m.hoan_thanh_luc | date:'HH:mm' }}</p>
                </div>
              </div>
            }
          } @else {
            <div class="empty-state">
              <img src="https://cdn-icons-png.flaticon.com/512/7486/7486747.png" alt="Empty">
              <p>Ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o. Chi·∫øn ngay ƒëi!</p>
            </div>
          }
        </div>
      </section>

      <div class="bottom-grid">
        <section class="card room-card">
          <h2 class="card-title">üì° Ph√≤ng ch·ªù</h2>
          @if (pendingBattles.length > 0) {
            <div class="room-list">
              @for (b of pendingBattles; track b.id) {
                <div class="room-item">
                  <span class="room-id">#{{ b.ma_phong }}</span>
                  <button class="btn-sm btn-join">V√†o ngay</button>
                </div>
              }
            </div>
          } @else {
            <p class="empty-text">Kh√¥ng c√≥ ph√≤ng ch·ªù.</p>
          }
        </section>

        <section class="featured-quiz-card">
          <h2>üìö B·ªô c√¢u h·ªèi n·ªïi b·∫≠t</h2>
          @if (featuredQuizzes.length > 0) {
            <ul>
              @for (q of featuredQuizzes; track q.id) {
                <li class="quiz-item">
                  <div class="quiz-info">
                    <span class="quiz-category-tag">{{ q.chu_de ?? 'Ch∆∞a c√≥' }}</span>
                    <p class="quiz-title">{{ q.tieu_de }}</p>
                    <p class="quiz-meta">Ng∆∞·ªùi t·∫°o: {{ q.nguoi_tao ?? '·∫®n danh' }}</p>
                  </div>
                  <button class="btn-train">Luy·ªán t·∫≠p</button>
                </li>
              }
            </ul>
          } @else {
            <p class="no-data">Ch∆∞a c√≥ b·ªô c√¢u h·ªèi n√†o n·ªïi b·∫≠t</p>
          }
        </section>
      </div>

    </main>
  </div>
</div>
