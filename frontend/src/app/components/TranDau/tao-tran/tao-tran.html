<div class="page-wrapper">
  <div class="bg-decoration shape-1"></div>
  <div class="bg-decoration shape-2"></div>

  <div class="create-card">
    <header class="create-header">
      <div class="header-icon">
        <i class="fas fa-gamepad"></i>
      </div>
      <h1>Thi·∫øt l·∫≠p ƒë·∫•u tr∆∞·ªùng</h1>
      <p>T√πy ch·ªânh lu·∫≠t ch∆°i v√† th√°ch th·ª©c ƒë·ªëi th·ªß!</p>
    </header>

    <form #createForm="ngForm" (ngSubmit)="onSubmit()" class="create-form">

      <section class="form-section">
        <h3 class="section-title"><i class="fas fa-sliders-h"></i> C·∫•u h√¨nh chung</h3>

        <div class="form-grid">
          <div class="form-group full-width">
            <label>T√™n ph√≤ng ƒë·∫•u <span class="required">*</span></label>
            <div class="input-wrapper">
              <i class="fas fa-signature input-icon"></i>
              <input
                type="text"
                [(ngModel)]="form.ten_phong"
                name="ten_phong"
                placeholder="VD: ƒê·∫°i chi·∫øn l·ªãch s·ª≠..."
                required
              />
            </div>
          </div>

          <div class="form-group full-width">
            <label>B·ªô c√¢u h·ªèi <span class="required">*</span></label>
            <div class="select-wrapper">
              <i class="fas fa-book-open input-icon"></i>
              <select
                [(ngModel)]="form.bo_cau_hoi_id"
                name="bo_cau_hoi_id"
                required
                (ngModelChange)="onBoCauHoiChanged($event)"
                [disabled]="loading_sets"
              >
                <option [ngValue]="0" disabled>‚Äî Ch·ªçn b·ªô c√¢u h·ªèi ‚Äî</option>
                @for (bo of boCauHoiOptions; track bo.id) {
                  <option [ngValue]="bo.id">{{ bo.tieu_de }}</option>
                }
              </select>
              <i class="fas fa-chevron-down arrow-icon"></i>
            </div>
            @if (loading_sets) {
              <small class="hint"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i danh s√°ch...</small>
            }
          </div>
        </div>
      </section>

      <section class="form-section">
        <h3 class="section-title"><i class="fas fa-trophy"></i> Ch·∫ø ƒë·ªô thi ƒë·∫•u</h3>

        <div class="visual-radio-group">
          <label class="visual-card casual-card" [class.selected]="form.loai_tran_dau === 'CASUAL'">
            <input
              type="radio"
              name="loai_tran_dau"
              [(ngModel)]="form.loai_tran_dau"
              value="CASUAL"
              (change)="onLoaiTranDauChange('CASUAL')"
              hidden
            >
            <div class="card-icon"><i class="fas fa-coffee"></i></div>
            <div class="card-info">
              <span class="card-title">ƒê·∫•u Vui (Casual)</span>
              <span class="card-desc">Kh√¥ng t√≠nh ƒëi·ªÉm x·∫øp h·∫°ng. Ch∆°i ƒë·ªÉ gi·∫£i tr√≠.</span>
            </div>
            <div class="check-mark"><i class="fas fa-check"></i></div>
          </label>

          <label class="visual-card ranked-card" [class.selected]="form.loai_tran_dau === 'RANKED'">
            <input
              type="radio"
              name="loai_tran_dau"
              [(ngModel)]="form.loai_tran_dau"
              value="RANKED"
              (change)="onLoaiTranDauChange('RANKED')"
              hidden
            >
            <div class="card-icon"><i class="fas fa-crown"></i></div>
            <div class="card-info">
              <span class="card-title">X·∫øp H·∫°ng (Ranked)</span>
              <span class="card-desc">C·∫°nh tranh gay g·∫Øt. Th·∫Øng c·ªông ƒëi·ªÉm, thua tr·ª´ ƒëi·ªÉm.</span>
            </div>
            <div class="check-mark"><i class="fas fa-check"></i></div>
          </label>
        </div>
      </section>

      <section class="form-section">
        <h3 class="section-title"><i class="fas fa-shield-alt"></i> Quy·ªÅn ri√™ng t∆∞ & Lu·∫≠t</h3>

        <div class="form-grid">
          <div class="form-group full-width">
            <label>Ai c√≥ th·ªÉ tham gia?</label>
            <div class="segment-control">
              <label class="segment-item" [class.active]="form.cong_khai">
                <input type="radio" name="cong_khai" [value]="true" [(ngModel)]="form.cong_khai" hidden>
                <i class="fas fa-globe"></i> C√¥ng khai
              </label>
              <label class="segment-item" [class.active]="!form.cong_khai">
                <input type="radio" name="cong_khai" [value]="false" [(ngModel)]="form.cong_khai" hidden>
                <i class="fas fa-lock"></i> Ri√™ng t∆∞ (C·∫ßn PIN)
              </label>
            </div>
          </div>

          @if (!form.cong_khai) {
            <div class="form-group pin-group full-width">
              <label>M√£ PIN v√†o ph√≤ng <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fas fa-key input-icon"></i>
                <input
                  type="text"
                  maxlength="10"
                  [(ngModel)]="form.ma_pin"
                  name="ma_pin"
                  class="pin-input"
                  placeholder="Nh·∫≠p m√£ b√≠ m·∫≠t..."
                />
              </div>
            </div>
          }

          <div class="form-group">
            <label>Gi·ªõi h·∫°n ng∆∞·ªùi (2-4)</label>
            <div class="number-control">
              <input
                type="number"
                min="2"
                max="4"
                [(ngModel)]="form.gioi_han_nguoi_choi"
                name="gioi_han_nguoi_choi"
              >
              <span class="unit">ng∆∞·ªùi</span>
            </div>
          </div>

          <div class="form-group">
            <label>Th·ªùi gian/c√¢u (gi√¢y)</label>
            <div class="number-control">
              <input
                type="number"
                min="5"
                max="120"
                [(ngModel)]="form.gioi_han_thoi_gian_cau_giay"
                name="gioi_han_thoi_gian_cau_giay"
              >
              <span class="unit">gi√¢y</span>
            </div>
          </div>

          <div class="form-group full-width">
            <label>Lu·∫≠t t√≠nh ƒëi·ªÉm</label>
            <div class="select-wrapper">
              <select [(ngModel)]="form.luat_tinh_diem" name="luat_tinh_diem">
                <option value="BASIC">BASIC ‚Äì ƒë√∫ng l√† c√≥ ƒëi·ªÉm</option>
                <option value="SPEED_BONUS">SPEED_BONUS ‚Äì nhanh ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÉm</option>
              </select>
              <i class="fas fa-chevron-down arrow-icon"></i>
            </div>
          </div>

        </div>
      </section>

      <div class="actions-footer">
        <button type="button" class="btn-ghost" (click)="cancel()">
          H·ªßy b·ªè
        </button>
        <button type="submit" class="btn-primary-3d" [disabled]="saving">
          @if (saving) {
            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫°o...
          } @else {
            üöÄ T·∫†O PH√íNG NGAY
          }
        </button>
      </div>
    </form>
  </div>
</div>

@if (isModalOpen) {
  <div class="modal-backdrop" (click)="closeModal()"></div>

  <div class="modal-container">
    <div class="modal-content">

      <header class="modal-header">
        <div class="header-left">
          <div class="icon-box"><i class="fas fa-search"></i></div>
          <div class="header-text">
            <h2>{{ getTieuDeBoCauHoi() }}</h2>
            <span class="meta-tag">
              <i class="fas fa-layer-group"></i> {{ preview_total || 0 }} c√¢u h·ªèi
            </span>
          </div>
        </div>
        <button class="btn-close" (click)="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </header>

      <div class="modal-body">
        @if (!preview_loading) {

          <div class="stat-section">
            <h4 class="stat-title"><i class="fas fa-chart-bar"></i> Ph√¢n b·ªë ƒë·ªô kh√≥</h4>
            <div class="difficulty-grid">
              @if (preview_difficulty_counts['DE']) {
                <div class="stat-pill level-easy">
                  <div class="pill-icon"><i class="fas fa-laugh-beam"></i></div>
                  <div class="pill-info">
                    <span class="label">D·ªÖ</span>
                    <span class="value">{{ preview_difficulty_counts['DE'] }}</span>
                  </div>
                </div>
              }

              @if (preview_difficulty_counts['TRUNG_BINH']) {
                <div class="stat-pill level-medium">
                  <div class="pill-icon"><i class="fas fa-meh"></i></div>
                  <div class="pill-info">
                    <span class="label">V·ª´a</span>
                    <span class="value">{{ preview_difficulty_counts['TRUNG_BINH'] }}</span>
                  </div>
                </div>
              }

              @if (preview_difficulty_counts['KHO']) {
                <div class="stat-pill level-hard">
                  <div class="pill-icon"><i class="fas fa-dizzy"></i></div>
                  <div class="pill-info">
                    <span class="label">Kh√≥</span>
                    <span class="value">{{ preview_difficulty_counts['KHO'] }}</span>
                  </div>
                </div>
              }
            </div>
          </div>

          <div class="stat-section">
            <h4 class="stat-title"><i class="fas fa-shapes"></i> ƒê·ªãnh d·∫°ng c√¢u h·ªèi</h4>
            <div class="type-grid">
              @if (preview_type_counts['VAN_BAN']) {
                <div class="type-card">
                  <i class="fas fa-font type-icon"></i>
                  <span>VƒÉn b·∫£n</span>
                  <strong>{{ preview_type_counts['VAN_BAN'] }}</strong>
                </div>
              }

              @if (preview_type_counts['HINH_ANH']) {
                <div class="type-card">
                  <i class="fas fa-image type-icon"></i>
                  <span>H√¨nh ·∫£nh</span>
                  <strong>{{ preview_type_counts['HINH_ANH'] }}</strong>
                </div>
              }

              @if (preview_type_counts['AM_THANH']) {
                <div class="type-card">
                  <i class="fas fa-music type-icon"></i>
                  <span>√Çm thanh</span>
                  <strong>{{ preview_type_counts['AM_THANH'] }}</strong>
                </div>
              }
            </div>
          </div>

        } @else {
          <div class="loading-state">
            <div class="spinner"></div>
            <p>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</p>
          </div>
        }
      </div>

      <footer class="modal-footer">
        <button class="btn-confirm" (click)="closeModal()">ƒê√£ hi·ªÉu</button>
      </footer>
    </div>
  </div>
}
