@if (!loading) {
  <div class="arena-container">

    <header class="arena-header">
      <div class="header-content">
        <h1>‚öîÔ∏è S·∫£nh ƒê·∫•u Tr∆∞·ªùng</h1>
        <p>Ch·ªçn ph√≤ng ƒë·ªÉ tham chi·∫øn ho·∫∑c t·∫°o th·ª≠ th√°ch ri√™ng c·ªßa b·∫°n!</p>
      </div>
      <button class="btn-3d btn-create" (click)="goToCreateRoom()">
        <i class="fas fa-plus-circle"></i> T·∫°o Tr·∫≠n ƒê·∫•u
      </button>
    </header>

    <div class="filter-section">
      <div class="filter-tabs">
        <button class="tab-item" [class.active]="filter_mode === 'ALL'" (click)="setFilter('ALL')">
          <i class="fas fa-globe"></i> T·∫•t c·∫£
        </button>
        <button class="tab-item" [class.active]="filter_mode === 'CASUAL'" (click)="setFilter('CASUAL')">
          <i class="fas fa-coffee"></i> Gi·∫£i tr√≠
        </button>
        <button class="tab-item" [class.active]="filter_mode === 'RANKED'" (click)="setFilter('RANKED')">
          <i class="fas fa-crown"></i> X·∫øp h·∫°ng
        </button>
      </div>

      <div class="result-count">
        T√¨m th·∫•y <b>{{ items.length }}</b> ph√≤ng
      </div>
    </div>

    @if (items.length > 0) {
      <div class="room-grid">
        @for (r of items; track r.id) {
          <div class="room-card" [ngClass]="r.loai_tran_dau === 'RANKED' ? 'card-ranked' : 'card-casual'">

            <div class="card-badges">
                <span class="badge" [class.badge-public]="r.cong_khai" [class.badge-private]="!r.cong_khai">
                    {{ r.cong_khai ? 'PUBLIC' : 'PRIVATE' }}
                </span>
              <span class="badge-mode">
                    @if (r.loai_tran_dau === 'RANKED') {
                      üëë Ranked
                    } @else {
                      ‚òï Casual
                    }
                </span>
            </div>

            <div class="card-main">
              <h3 class="room-name" [title]="r.ten_phong">{{ r.ten_phong || ('Ph√≤ng #' + r.id) }}</h3>
              <p class="quiz-name"><i class="fas fa-book"></i> {{ r.bo_cau_hoi_tieu_de }}</p>
            </div>

            <div class="card-stats">
              <div class="stat-row" title="Ch·ªß ph√≤ng">
                <i class="fas fa-user-astronaut"></i> <span>{{ r.chu_phong_ten }}</span>
              </div>
              <div class="stat-row" title="S·ªë ng∆∞·ªùi">
                <i class="fas fa-users"></i> <span>{{ r.gioi_han_nguoi_choi }} ng∆∞·ªùi</span>
              </div>
              <div class="stat-row" title="Th·ªùi gian">
                <i class="fas fa-clock"></i> <span>{{ r.gioi_han_thoi_gian_cau_giay }}s/c√¢u</span>
              </div>
              <div class="stat-row" title="Lu·∫≠t ch∆°i">
                <i class="fas fa-gavel"></i> <span>{{ r.luat_tinh_diem }}</span>
              </div>
            </div>

            <button class="btn-join" (click)="tryJoin(r)">
              V√ÄO PH√íNG NGAY
            </button>
          </div>
        }
      </div>
    } @else {
      <div class="empty-state">
        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486747.png" alt="Empty">
        <h3>Ch∆∞a c√≥ ph√≤ng n√†o ƒë∆∞·ª£c t·∫°o!</h3>
        <p>H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n t·∫°o ph√≤ng v√† m·ªùi b·∫°n b√® nh√©.</p>
        <button class="btn-ghost" (click)="goToCreateRoom()">T·∫°o ph√≤ng ngay</button>
      </div>
    }

    @if (totalPages > 1) {
      <div class="pagination-container">
        <button class="page-btn" (click)="changePage(page - 1)" [disabled]="page === 0">
          <i class="fas fa-chevron-left"></i>
        </button>

        @for (p of getVisiblePages(); track $index) {
          @if (p >= 0) {
            <button class="page-btn" [class.active]="p === page" (click)="changePage(p)">
              {{ p + 1 }}
            </button>
          } @else {
            <span class="dots">...</span>
          }
        }

        <button class="page-btn" (click)="changePage(page + 1)" [disabled]="page === totalPages - 1">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    }

  </div>
} @else {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu ƒë·∫•u tr∆∞·ªùng...</p>
  </div>
}
