# Hướng dẫn Test API Khóa Học

## Base URL
```
http://localhost:8088/api/v1/khoa-hoc
```

## Authentication
Tất cả các endpoint (trừ GET danh sách) yêu cầu JWT token trong header:
```
Authorization: Bearer <your_jwt_token>
```

---

## 1. GET - Lấy danh sách khóa học

**Endpoint:** `GET /api/v1/khoa-hoc`

**Query Parameters:**
- `keyword` (optional): Tìm kiếm theo tiêu đề
- `chu_de_id` (optional): Lọc theo chủ đề (default: 0)
- `trang_thai` (optional): Lọc theo trạng thái (DRAFT, PUBLISHED, ARCHIVED)
- `sort_order` (optional): NEWEST hoặc OLDEST (default: NEWEST)
- `page` (optional): Số trang (default: 0)
- `limit` (optional): Số item mỗi trang (default: 10)

**Example Request:**
```bash
curl -X GET "http://localhost:8088/api/v1/khoa-hoc?keyword=&chu_de_id=1&trang_thai=PUBLISHED&page=0&limit=10"
```

**Expected Response (200 OK):**
```json
{
  "message": "Lấy danh sách khóa học thành công",
  "status": "OK",
  "data": {
    "items": [
      {
        "id": 1,
        "tieu_de": "Khóa học Toán Logic",
        "mo_ta": "Khóa học về toán logic cơ bản",
        "hinh_anh": null,
        "chu_de": "Toán học",
        "chu_de_id": 1,
        "nguoi_tao": "Admin",
        "nguoi_tao_id": 1,
        "trang_thai": "PUBLISHED",
        "gia_mo_khoa": 0,
        "thu_tu": 1,
        "so_bo_cau_hoi": 5,
        "co_quyen_sua": true,
        "tao_luc": "2024-01-01T00:00:00Z",
        "cap_nhat_luc": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 1,
    "page": 0,
    "limit": 10,
    "totalPages": 1
  }
}
```

---

## 2. GET - Lấy chi tiết khóa học

**Endpoint:** `GET /api/v1/khoa-hoc/{id}`

**Example Request:**
```bash
curl -X GET "http://localhost:8088/api/v1/khoa-hoc/1" \
  -H "Authorization: Bearer <token>"
```

**Expected Response (200 OK):**
```json
{
  "message": "Lấy chi tiết khóa học thành công",
  "status": "OK",
  "data": {
    "khoa_hoc": {
      "id": 1,
      "tieu_de": "Khóa học Toán Logic",
      "mo_ta": "Khóa học về toán logic cơ bản",
      "hinh_anh": null,
      "chu_de": "Toán học",
      "chu_de_id": 1,
      "nguoi_tao": "Admin",
      "nguoi_tao_id": 1,
      "trang_thai": "PUBLISHED",
      "gia_mo_khoa": 0,
      "thu_tu": 1,
      "so_bo_cau_hoi": 5,
      "co_quyen_sua": true,
      "tao_luc": "2024-01-01T00:00:00Z",
      "cap_nhat_luc": "2024-01-01T00:00:00Z"
    },
    "danh_sach_bo_cau_hoi": [
      {
        "id": 1,
        "bo_cau_hoi_id": 10,
        "tieu_de": "Bộ câu hỏi Toán Logic - Bài 1",
        "so_cau_hoi": 20,
        "thu_tu": 1,
        "is_bat_buoc": true,
        "diem_toi_thieu": 60,
        "trang_thai": "DA_MO_KHOA",
        "da_mo_khoa": true,
        "can_mo_khoa": false,
        "gia_mo_khoa": 0
      }
    ],
    "tien_do": {
      "id": 1,
      "khoa_hoc_id": 1,
      "so_bo_da_hoan_thanh": 2,
      "tong_so_bo": 5,
      "phan_tram_hoan_thanh": 40.00,
      "bo_cau_hoi_hien_tai_id": 11,
      "trang_thai": "DANG_HOC",
      "ngay_bat_dau": "2024-01-01T00:00:00Z",
      "ngay_hoan_thanh": null
    }
  }
}
```

**Error Cases:**
- 404: Khóa học không tồn tại
- 403: Không có quyền xem (không phải PUBLISHED và không phải owner)

---

## 3. POST - Tạo khóa học mới (Chỉ Admin)

**Endpoint:** `POST /api/v1/khoa-hoc`

**Required Role:** ROLE_ADMIN

**Request Body:**
```json
{
  "tieu_de": "Khóa học Toán Logic",
  "mo_ta": "Khóa học về toán logic cơ bản",
  "hinh_anh": "https://example.com/image.jpg",
  "chu_de_id": 1,
  "trang_thai": "DRAFT",
  "gia_mo_khoa": 0,
  "thu_tu": 1,
  "danh_sach_bo_cau_hoi": [
    {
      "bo_cau_hoi_id": 10,
      "thu_tu": 1,
      "is_bat_buoc": true,
      "diem_toi_thieu": 60
    },
    {
      "bo_cau_hoi_id": 11,
      "thu_tu": 2,
      "is_bat_buoc": true,
      "diem_toi_thieu": 70
    }
  ]
}
```

**Example Request:**
```bash
curl -X POST "http://localhost:8088/api/v1/khoa-hoc" \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "tieu_de": "Khóa học Toán Logic",
    "mo_ta": "Khóa học về toán logic cơ bản",
    "chu_de_id": 1,
    "trang_thai": "DRAFT",
    "gia_mo_khoa": 0,
    "thu_tu": 1,
    "danh_sach_bo_cau_hoi": [
      {
        "bo_cau_hoi_id": 10,
        "thu_tu": 1,
        "is_bat_buoc": true,
        "diem_toi_thieu": 60
      }
    ]
  }'
```

**Expected Response (201 Created):**
```json
{
  "message": "Tạo khóa học thành công",
  "status": "CREATED",
  "data": {
    "id": 1,
    "tieu_de": "Khóa học Toán Logic",
    "mo_ta": "Khóa học về toán logic cơ bản",
    ...
  }
}
```

**Error Cases:**
- 400: Dữ liệu không hợp lệ (validation errors)
- 400: Chỉ admin mới có quyền tạo khóa học
- 400: Chủ đề không tồn tại
- 400: Bộ câu hỏi không tồn tại

---

## 4. PUT - Cập nhật khóa học (Admin hoặc Owner)

**Endpoint:** `PUT /api/v1/khoa-hoc/{id}`

**Required Role:** ROLE_ADMIN hoặc Owner

**Request Body:** (tương tự POST, tất cả fields optional)

**Example Request:**
```bash
curl -X PUT "http://localhost:8088/api/v1/khoa-hoc/1" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "tieu_de": "Khóa học Toán Logic - Cập nhật",
    "trang_thai": "PUBLISHED"
  }'
```

**Expected Response (200 OK):**
```json
{
  "message": "Cập nhật khóa học thành công",
  "status": "OK",
  "data": {
    "id": 1,
    "tieu_de": "Khóa học Toán Logic - Cập nhật",
    ...
  }
}
```

**Error Cases:**
- 404: Khóa học không tồn tại
- 403: Không có quyền sửa (không phải admin và không phải owner)

---

## 5. DELETE - Xóa cứng khóa học (Admin hoặc Owner)

**Endpoint:** `DELETE /api/v1/khoa-hoc/{id}`

**Required Role:** ROLE_ADMIN hoặc Owner

**Example Request:**
```bash
curl -X DELETE "http://localhost:8088/api/v1/khoa-hoc/1" \
  -H "Authorization: Bearer <token>"
```

**Expected Response (200 OK):**
```json
{
  "message": "Xóa khóa học thành công",
  "status": "OK",
  "data": null
}
```

---

## 6. DELETE - Xóa mềm khóa học (Admin hoặc Owner)

**Endpoint:** `DELETE /api/v1/khoa-hoc/{id}/soft`

**Required Role:** ROLE_ADMIN hoặc Owner

**Example Request:**
```bash
curl -X DELETE "http://localhost:8088/api/v1/khoa-hoc/1/soft" \
  -H "Authorization: Bearer <token>"
```

**Expected Response (200 OK):**
```json
{
  "message": "Xóa mềm khóa học thành công",
  "status": "OK",
  "data": null
}
```

---

## Test Checklist

### ✅ Test Cases cần kiểm tra:

1. **GET danh sách:**
   - [ ] Lấy danh sách thành công (không cần auth)
   - [ ] Filter theo chủ đề
   - [ ] Filter theo trạng thái
   - [ ] Pagination hoạt động đúng
   - [ ] Search theo keyword

2. **GET chi tiết:**
   - [ ] Lấy chi tiết thành công (có auth)
   - [ ] Trả về danh sách bộ câu hỏi đúng thứ tự
   - [ ] Trả về unlock status đúng
   - [ ] Trả về tiến độ nếu user đã học
   - [ ] 404 khi không tồn tại
   - [ ] 403 khi không có quyền xem (DRAFT, không phải owner)

3. **POST tạo mới:**
   - [ ] Tạo thành công với admin token
   - [ ] Tạo với danh sách bộ câu hỏi
   - [ ] 403 khi không phải admin
   - [ ] 400 khi thiếu required fields
   - [ ] 400 khi chủ đề không tồn tại
   - [ ] 400 khi bộ câu hỏi không tồn tại

4. **PUT cập nhật:**
   - [ ] Cập nhật thành công (admin)
   - [ ] Cập nhật thành công (owner)
   - [ ] Cập nhật danh sách bộ câu hỏi
   - [ ] 403 khi không có quyền
   - [ ] 404 khi không tồn tại

5. **DELETE:**
   - [ ] Xóa cứng thành công
   - [ ] Xóa mềm thành công
   - [ ] 403 khi không có quyền
   - [ ] 404 khi không tồn tại

---

## Lưu ý khi test:

1. **Chuẩn bị dữ liệu:**
   - Cần có ít nhất 1 chủ đề (ChuDe) trong DB
   - Cần có ít nhất vài bộ câu hỏi (BoCauHoi) trong DB
   - Cần có admin account để test create/update/delete

2. **JWT Token:**
   - Lấy token từ endpoint login
   - Token cần có role ROLE_ADMIN để test create/update/delete

3. **Database:**
   - Đảm bảo các bảng đã được tạo:
     - `khoa_hoc`
     - `khoa_hoc_bo_cau_hoi`
     - `tien_do_khoa_hoc`
     - `tien_do_bo_cau_hoi_trong_khoa`
     - `phan_tich_hoc_tap`

