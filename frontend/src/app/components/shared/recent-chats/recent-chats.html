<div class="recent-chats-section">
    <!-- Collapsed Header (always visible) -->
    <div class="section-header" (click)="toggleExpand()">
        <div class="header-left">
            <i class="fas fa-comments icon"></i>
            <span class="title">Tin nhắn</span>
            @if (unreadTotal > 0) {
            <span class="unread-badge">{{ unreadTotal }}</span>
            }
        </div>
        <button class="btn-toggle" [class.expanded]="isExpanded">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- Expandable Content -->
    @if (isExpanded) {
    <div class="section-content">
        @if (loading) {
        <div class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Đang tải...</span>
        </div>
        }

        @if (!loading && inboxItems.length === 0) {
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <span>Chưa có tin nhắn nào</span>
        </div>
        }

        @if (!loading && inboxItems.length > 0) {
        <div class="chat-list">
            @for (item of inboxItems; track item.partnerId) {
            <div class="chat-item"
                [class.unread]="item.unreadCount > 0"
                (click)="openChatBox(item)">
                <div class="avatar">
                    <img [src]="getAvatarUrl(item)"
                        [alt]="item.partnerName" />
                </div>
                <div class="chat-info">
                    <span class="name">{{ item.partnerName }}</span>
                    <span class="preview">
                        {{ truncateMessage(item.lastMessage) || 'Bắt
                        đầu trò chuyện...' }}
                    </span>
                </div>
                <div class="chat-meta">
                    <span class="time">{{ formatTime(item.lastTime)
                        }}</span>
                    @if (item.unreadCount > 0) {
                    <span class="unread-count">{{ item.unreadCount
                        }}</span>
                    }
                </div>
            </div>
            }
        </div>

        <!-- View All Button -->
        <button class="btn-view-all"
            (click)="goToChat(); $event.stopPropagation()">
            <i class="fas fa-arrow-right"></i>
            Xem tất cả tin nhắn
        </button>
        }
    </div>
    }
</div>