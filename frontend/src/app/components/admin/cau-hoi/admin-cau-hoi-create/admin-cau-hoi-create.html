<div class="question-page">
  <div class="question-container">
    <!-- üß≠ Header -->
    <header class="header">
      <h1>
        <i class="fas fa-plus-circle"></i>
        Th√™m C√¢u H·ªèi M·ªõi (Admin)
      </h1>
      <button type="button" class="btn btn-gray" (click)="cancel()">
        <i class="fas fa-arrow-left"></i> Quay L·∫°i
      </button>
    </header>

    <form #form="ngForm" (ngSubmit)="onSubmit(form)" class="form-card animate-fade">
      <!-- 1Ô∏è‚É£ N·ªôi dung -->
      <section class="section">
        <h2><i class="fas fa-file-alt"></i> 1. N·ªôi dung & Lo·∫°i c√¢u h·ªèi</h2>

        <div class="input-group">
          <label>Lo·∫°i c√¢u h·ªèi</label>
          <select
            [(ngModel)]="model.loai_noi_dung"
            name="loai_noi_dung"
            class="input-control"
            (change)="onLoaiNoiDungChange()">
            <option value="VAN_BAN">VƒÉn b·∫£n</option>
            <option value="HINH_ANH">H√¨nh ·∫£nh</option>
            <option value="AM_THANH">√Çm thanh</option>
          </select>
        </div>

        <div class="input-group">
          <label>N·ªôi dung <span class="required">*</span></label>
          <textarea
            [(ngModel)]="model.noi_dung"
            name="noi_dung"
            rows="4"
            placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi..."
            required></textarea>
        </div>

        @if (model.loai_noi_dung !== 'VAN_BAN') {
          <div class="input-group">
            <label>T·ªáp ƒë√≠nh k√®m</label>
            <input
              type="file"
              accept="image/*,audio/*"
              (change)="onFileSelected($event)">

            @if (previewUrl) {
              <div class="media-preview">
                <div class="media-box"
                     (mouseenter)="hovering = true"
                     (mouseleave)="hovering = false">
                  @switch (model.loai_noi_dung) {
                    @case ('HINH_ANH') {
                      <img [src]="previewUrl" alt="preview" class="media-img"/>
                    }
                    @case ('AM_THANH') {
                      <div class="audio-wrapper">
                        <audio controls [src]="previewUrl"></audio>
                      </div>
                    }
                  }
                  @if (hovering) {
                    <button
                      type="button"
                      class="remove-btn"
                      (click)="removeSelectedFile()">
                      <i class="fas fa-times"></i>
                    </button>
                  }
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- 2Ô∏è‚É£ L·ª±a ch·ªçn -->
      <section class="section">
        <h2><i class="fas fa-list-ul"></i> 2. L·ª±a ch·ªçn & ƒê√°p √°n</h2>

        <div class="options-wrapper">
          @for (opt of ['A', 'B', 'C', 'D']; track opt) {
            <label class="option-card" [class.selected]="model.dap_an_dung === opt">
              <input
                type="radio"
                name="dap_an_dung"
                [value]="opt"
                [(ngModel)]="model.dap_an_dung"
                class="radio-hidden">

              <div class="option-circle">{{ opt }}</div>
              <input
                type="text"
                class="option-input"
                [(ngModel)]="model['lua_chon_' + opt.toLowerCase()]"
                name="lua_chon_{{opt}}"
                placeholder="Nh·∫≠p l·ª±a ch·ªçn {{opt}}"
                required>
            </label>
          }
        </div>

        <p class="hint">
          <i class="fas fa-lightbulb"></i>
          H√£y t√≠ch v√†o √¥ tr√≤n ho·∫∑c nh·∫•p th·∫ª ƒë·ªÉ ch·ªçn ƒë√°p √°n ƒë√∫ng.
        </p>
      </section>

      <!-- 3Ô∏è‚É£ Gi·∫£i th√≠ch -->
      <section class="section">
        <h2><i class="fas fa-brain"></i> 3. Gi·∫£i th√≠ch & ƒê·ªô kh√≥</h2>

        <div class="input-group">
          <label>Gi·∫£i th√≠ch</label>
          <textarea
            [(ngModel)]="model.giai_thich"
            name="giai_thich"
            rows="3"
            placeholder="Nh·∫≠p gi·∫£i th√≠ch cho ƒë√°p √°n ƒë√∫ng (n·∫øu c√≥)"></textarea>
        </div>

        <div class="input-group half">
          <label>ƒê·ªô kh√≥</label>
          <select
            [(ngModel)]="model.do_kho"
            name="do_kho"
            class="input-control">
            <option value="DE">D·ªÖ</option>
            <option value="TRUNG_BINH">Trung B√¨nh</option>
            <option value="KHO">Kh√≥</option>
          </select>
        </div>
      </section>

      <!-- 4Ô∏è‚É£ Buttons -->
      <div class="form-actions">
        <button type="button" class="btn btn-gray" (click)="cancel()">
          <i class="fas fa-times"></i> H·ªßy
        </button>
        <button
          type="submit"
          class="btn btn-green"
          [disabled]="submitting || form.invalid">
          <i class="fas fa-save"></i> L∆∞u & Th√™m M·ªõi
        </button>
      </div>
    </form>
  </div>
</div>
